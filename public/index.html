<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width initial-scale=1"
  />

  <title>Video Game Collection Manager</title>

  <link
    rel="preconnect"
    href="https://fonts.googleapis.com"
  >
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  >
  <link
    href="https://fonts.googleapis.com/css2?family=Jost:wght@100..900&display=swap"
    rel="stylesheet"
  >
  <link
    rel="stylesheet"
    href="style.css"
  />

  <!--  DOMPurify cleans up HTML to prevent XSS attacks
  https://www.jsdelivr.com/package/npm/dompurify  -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.3.0/dist/purify.min.js"></script>

</head>

<body>
  <header>
    <h1>Video Game Collection Manager</h1>
    <h4>CRUD: a full data lifecycle</h4>
  </header>
  <section id="status">
    <p id="readyStatus">‚úÖ MongoDB is Ready</p>
    <p id="notReadyStatus">‚ùå MongoDB is not connected. Please check your connection string in <code>.env</code> file.
    </p>
  </section>
  <button id="createButton">Add New Game</button>

  <dialog id="formDialog">
    <div class="modal-container">
      <div class="modal-header">
        <h2>üéÆ Add a Video Game</h2>
        <p>Add a game to your collection</p>
      </div>

      <div class="modal-body">
        <form
          id="myForm"
          method="dialog"
        >
      <!-- Hidden field to store ID for updates -->
      <input
        type="hidden"
        name="id"
        id="id"
      />

      


      <fieldset>
        <label for="title">Game Title</label>
        <input
          required
          type="text"
          name="title"
          id="title"
          placeholder="e.g. The Legend of Zelda"
          autocomplete="off"
        />
        <small class="validation">Title is required</small>
      </fieldset>

      <fieldset>
        <label for="releaseDate">Release Date</label>
        <input
          type="date"
          name="releaseDate"
          id="releaseDate"
        />
      </fieldset>

      <fieldset>
        <label for="image">Cover Image</label>
        <input
          type="file"
          name="image"
          id="image"
          accept="image/*"
        />
        <small>Upload an image to use as the game icon.</small>
        <div class="image-preview">
          <img id="imagePreview" alt="Preview" style="display:none; max-width:120px; height:auto;" />
        </div>
      </fieldset>

      <fieldset>
        <label for="genre">Genre</label>
        <select
          name="genre"
          id="genre"
        >
          <option
            value=""
            disabled
            selected
          >Select a Genre</option>
          <option value="Action">Action</option>
          <option value="Adventure">Adventure</option>
          <option value="RPG">RPG</option>
          <option value="Strategy">Strategy</option>
          <option value="Simulation">Simulation</option>
          <option value="Sports">Sports</option>
          <option value="Racing">Racing</option>
          <option value="Fighting">Fighting</option>
          <option value="Platformer">Platformer</option>
          <option value="Puzzle">Puzzle</option>
          <option value="Shooter">Shooter</option>
          <option value="Horror">Horror</option>
          <option value="Survival">Survival</option>
          <option value="MMORPG">MMORPG</option>
          <option value="Other">Other</option>
        </select>
      </fieldset>

      <fieldset>
        <label for="platform">Platform</label>
        <select
          name="platform"
          id="platform"
        >
          <option
            value=""
            disabled
            selected
          >Select a Platform</option>
          <option value="PC">PC</option>
          <option value="PlayStation 5">PlayStation 5</option>
          <option value="PlayStation 4">PlayStation 4</option>
          <option value="Xbox Series X/S">Xbox Series X/S</option>
          <option value="Xbox One">Xbox One</option>
          <option value="Nintendo Switch">Nintendo Switch</option>
          <option value="Mobile">Mobile</option>
          <option value="Multi-Platform">Multi-Platform</option>
          <option value="Other">Other</option>
        </select>
      </fieldset>

      <fieldset>
        <label for="publisher">Publisher</label>
        <input
          type="text"
          name="publisher"
          id="publisher"
          placeholder="e.g. Nintendo"
          autocomplete="off"
        />
      </fieldset>

      <fieldset>
        <label for="developer">Developer</label>
        <input
          type="text"
          name="developer"
          id="developer"
          placeholder="e.g. Nintendo EPD"
          autocomplete="off"
        />
      </fieldset>

      <fieldset>
        <label for="rating">Rating</label>
        <small>Rate this game out of 10</small>
        <input
          type="number"
          min="0"
          max="10"
          step="0.1"
          name="rating"
          id="rating"
          placeholder="e.g. 8.5"
        />
      </fieldset>

      <fieldset>
        <label for="price">Price (USD)</label>
        <input
          type="number"
          min="0"
          step="0.01"
          name="price"
          id="price"
          placeholder="e.g. 59.99"
        />
      </fieldset>

      <fieldset>
        <label for="hoursPlayed">Hours Played</label>
        <input
          type="number"
          min="0"
          step="1"
          name="hoursPlayed"
          id="hoursPlayed"
          placeholder="e.g. 45"
        />
      </fieldset>

      <fieldset>
        <label for="description">Description</label>
        <small>Provide a brief summary of the game.</small>
        <textarea
          placeholder="Game description..."
          required
          minlength="20"
          name="description"
          id="description"
          rows="6"
          cols="30"
        ></textarea>
        <small class="validation">Description must be at least 20 characters.</small>
      </fieldset>

      <fieldset>
        <label for="difficulty">Difficulty</label>
        <small>How challenging is this game?</small>
        <input
          type="range"
          min="0"
          max="10"
          name="difficulty"
          id="difficulty"
        />
      </fieldset>

      <fieldset>
        <label for="replayValue">Replay Value</label>
        <small>How replayable is this game?</small>
        <input
          type="range"
          min="0"
          max="10"
          name="replayValue"
          id="replayValue"
        />
      </fieldset>

      <fieldset>
        <legend>Game Features</legend>
        <label for="multiplayer">
          <input
            type="checkbox"
            name="multiplayer"
            id="multiplayer"
          />
          <span>Multiplayer</span>
        </label>
        <label for="completed">
          <input
            type="checkbox"
            name="completed"
            id="completed"
          />
          <span>Completed</span>
        </label>
      </fieldset>
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="save"
          id="saveButton"
        >Save</button>
        <button
          type="button"
          class="cancel"
          id="cancelButton"
        >Cancel</button>
      </div>
    </div>
  </dialog>

  <main>
    <h2>üéÆ Video Game Collection</h2>
    <section id="contentArea"></section>
  </main>

  <section id="intro">
    <h3>About</h3>
    <p>Previously we explored approaches to <a
        href="https://github.com/ixd-system-design/API-Endpoints-for-Publishing-and-Searching"
      >Publishing Data</a> and <a href="https://github.com/ixd-system-design/Collecting-Data">Collecting Data</a> by
      means of API Endpoints (backend) and HTML forms (frontend). Having thus addressed the first two letters of
      <a href="https://developer.mozilla.org/en-US/docs/Glossary/CRUD">CRUD</a> ("Create" and Read"), let's now
      implement the last two letters as well ("Update" and "Delete"). This will
      allow us to manage the full lifecycle of data records in our database.
    </p>
    <p>In order to operate on existing documents, we need to identify them by ID. The following two endpoints will
      assume that we pass along the ID of the item to be updated or deleted:
    <ol>
      <li>An Express endpoint listens for HTTP <a
          href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/PUT"
        >PUT</a> requests, with an ID parameter and a body payload (the updated data). Prisma
        finds the corresponding document in the database and replaces it with the new data.</li>
      <li>An Express endpoint listens for HTTP <a
          href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/PUT"
        >DELETE</a> requests, with an ID paramater passed along. Prisma finds the corresponding document and
        removes it from the database.</li>
    </ol>
    </p>
    <p>
      To support these new operations on the frontend, we have adjusted the form behaviour. When editing an item, the
      ID of the item is stored in a hidden input field. This allows us to track which item is being edited, and send
      the correct ID to the backend when submitting updates. We also use the ID in the display template, so that the
      Edit and Delete buttons can function correctly, and so that we can identify which item to remove when deleting.
    </p>

    <h3>Learning Prompts</h3>
    <p>Can you add a connection string to the NodeJS environment (e.g. .env file) for your own MongoDB Atlas Cluster?
    </p>
    <p>Use MongoDB Compass to verify that your data collection form is working. </p>
    <p>Try out all CRUD operations: Create a new game, Edit an existing game by clicking the Edit button, and Delete a game
      you no longer need.</p>
    <p>Explore the API endpoints in your browser: visit /data to see all games in JSON format, or try /search?terms=Zelda
      to search for specific games.</p>
  </section>

  <footer>
    Created by <a href="https://nsitu.ca">Harold Sikkema</a> in the context of
    Systems Design in the Interaction Design program at Sheridan College.
  </footer>

  <script
    src="script.js"
    type="module"
  ></script>

</body>

</html>